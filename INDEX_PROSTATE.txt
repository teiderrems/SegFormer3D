ğŸ“‹ INDEX COMPLET - SegFormer3D Adaptation Prostate
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Bienvenue! Voici un guide complet pour naviguer dans l'adaptation de SegFormer3D 
pour la segmentation de prostate avec fichiers nii.gz.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š DOCUMENTATION (A LIRE D'ABORD)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ğŸŸ¢ ADAPTATION_PROSTATE_README.txt
   Niveau: DÃ©butant
   Contenu:
     â€¢ RÃ©sumÃ© exÃ©cutif du projet
     â€¢ Vue d'ensemble des fichiers crÃ©Ã©s
     â€¢ DÃ©marrage rapide (3 commandes)
     â€¢ DiffÃ©rences BraTS â†” Prostate
     â€¢ Checklist avant entraÃ®nement
   ğŸ‘‰ COMMENCEZ PAR CE FICHIER

2. ğŸ”µ GUIDE_PROSTATE_COMPLETE_FR.md
   Niveau: IntermÃ©diaire
   Contenu:
     â€¢ Explications dÃ©taillÃ©es de chaque Ã©tape
     â€¢ Structure des donnÃ©es complÃ¨te
     â€¢ Pipeline complet (prÃ©traitement â†’ infÃ©rence)
     â€¢ Exemples pratiques (bash + Python)
     â€¢ DÃ©pannage et solutions
     â€¢ Configuration avancÃ©e
   ğŸ‘‰ POUR COMPRENDRE LE WORKFLOW COMPLET

3. ğŸŸ¡ FICHIERS_PROSTATE_RESUME.txt
   Niveau: RÃ©fÃ©rence
   Contenu:
     â€¢ Description dÃ©taillÃ©e de chaque fichier crÃ©Ã©
     â€¢ Statistiques et tailles
     â€¢ Modifications aux fichiers existants
     â€¢ Checklist d'implÃ©mentation
     â€¢ Points clÃ©s Ã  retenir
   ğŸ‘‰ POUR RÃ‰FÃ‰RENCE LORS DU DÃ‰VELOPPEMENT

4. ğŸ“‹ INDEX_PROSTATE.txt (CE FICHIER)
   â€¢ Vous Ãªtes ici!
   â€¢ Navigation dans la documentation
   â€¢ Structure du projet

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ—‚ï¸ STRUCTURE DES FICHIERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CODE PYTHON - PrÃªt Ã  utiliser
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. ğŸ“¦ Dataloaders (Interface de donnÃ©es)
   Fichier: dataloaders/prostate_seg.py (12 KB, ~320 lignes)
   Classes:
     â€¢ ProstateSegDataset
       â””â”€ Charge donnÃ©es .pt, applique augmentations
     â€¢ ProstateSegDatasetMultiModal
       â””â”€ Support modalitÃ©s variables
   Utilisation dans config:
     dataset_type: "prostate_seg"
     dataset_args:
       root: "./data/prostate_data"

2. ğŸ”§ PrÃ©traitement (NII.GZ â†’ PyTorch)
   Fichier: data/prostate_raw_data/prostate_preprocess.py (16 KB, ~450 lignes)
   Classe:
     â€¢ ProstatePreprocessor
       â”œâ”€ load_nifti(): Charge fichiers nii.gz
       â”œâ”€ resample_volume(): Resample 96Ã—96Ã—96
       â”œâ”€ normalize_intensity(): Normalisation
       â””â”€ preprocess_case(): Traite un patient complet
   CLI:
     python prostate_preprocess.py \
        --input_dir ./data/prostate_raw_data \
        --output_dir ./data/prostate_data/preprocessed

3. ğŸ“Š GÃ©nÃ©rateur de Splits
   Fichier: data/prostate_raw_data/create_prostate_splits.py (8 KB, ~280 lignes)
   Fonctions:
     â€¢ get_case_names(): Liste patients
     â€¢ train_val_split(): Split 80-20
     â€¢ kfold_split(): K-fold cross-validation
   CLI:
     python create_prostate_splits.py \
        --input_dir ./data/prostate_data/preprocessed \
        --kfold 5

4. ğŸ§  InfÃ©rence (PrÃ©diction)
   Fichier: experiments/prostate_seg/inference_prostate.py (16 KB, ~450 lignes)
   Classe:
     â€¢ ProstateInferencer
       â”œâ”€ load_model(): Charge checkpoint
       â”œâ”€ predict(): InfÃ©rence (simple ou sliding window)
       â”œâ”€ post_process(): Nettoyage segmentation
       â””â”€ save_nifti(): Export rÃ©sultat
   CLI:
     python inference_prostate.py \
        --model_path ./checkpoint/best.pt \
        --input_dir ./test_data \
        --output_dir ./predictions

CONFIGURATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5. âš™ï¸ Configuration EntraÃ®nement
   Fichier: experiments/prostate_seg/config_prostate.yaml (8 KB)
   ParamÃ¨tres clÃ©s:
     data:
       dataset_type: "prostate_seg"
       dataset_args:
         root: "./data/prostate_data"
     
     model:
       in_channels: 2          # T2, ADC
       num_classes: 2          # bg, prostate
       embed_dim: 64
       num_layers: 4
     
     training:
       lr: 0.001
       batch_size: 4
       num_epochs: 200
   ğŸ“ Ã€ adapter selon vos donnÃ©es

SCRIPTS UTILITAIRES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6. ğŸš€ Quick Start (Automatisation)
   Fichier: ./quick_start_prostate.sh (12 KB)
   Ã‰tapes:
     1. PrÃ©traitement interactif
     2. GÃ©nÃ©ration splits
     3. Lancement entraÃ®nement (optionnel)
     4. InfÃ©rence (optionnel)
   Utilisation:
     chmod +x quick_start_prostate.sh
     ./quick_start_prostate.sh /chemin/donnÃ©es

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”„ WORKFLOW COMPLET (Ã‰tape par Ã©tape)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã‰TAPE 1: PRÃ‰PARER LES DONNÃ‰ES (Vos donnÃ©es)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Structure attendue:
  data/prostate_raw_data/
  â”œâ”€â”€ patient_001/
  â”‚   â”œâ”€â”€ T2.nii.gz              â† IRM T2
  â”‚   â”œâ”€â”€ ADC.nii.gz             â† IRM ADC
  â”‚   â””â”€â”€ segmentation.nii.gz    â† Segmentation (0/1)
  â”œâ”€â”€ patient_002/
  â””â”€â”€ ...

ğŸ“– Pour plus: GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "Structure des donnÃ©es"

Ã‰TAPE 2: PRÃ‰TRAITEMENT (NII.GZ â†’ PyTorch)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Commande:
  python data/prostate_raw_data/prostate_preprocess.py \
     --input_dir ./data/prostate_raw_data \
     --output_dir ./data/prostate_data/preprocessed \
     --target_size 96

Processus:
  1. Charge chaque fichier nii.gz
  2. Resample Ã  96Ã—96Ã—96
  3. Normalise intensitÃ©s [0, 1]
  4. Empile T2 + ADC = (2, 96, 96, 96)
  5. Binarise segmentation
  6. Sauvegarde en .pt

Output:
  data/prostate_data/preprocessed/
  â”œâ”€â”€ patient_001/
  â”‚   â”œâ”€â”€ patient_001_modalities.pt  (2, 96, 96, 96)
  â”‚   â””â”€â”€ patient_001_label.pt       (1, 96, 96, 96)
  â””â”€â”€ ...

Code: dataloaders/prostate_seg.py â†’ ProstatePreprocessor
ğŸ“– Pour plus: data/prostate_raw_data/prostate_preprocess.py

Ã‰TAPE 3: GÃ‰NÃ‰RATION DES SPLITS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Commande (80-20 split):
  python data/prostate_raw_data/create_prostate_splits.py \
     --input_dir ./data/prostate_data/preprocessed \
     --output_dir ./data/prostate_data

Ou (5-fold cross-validation):
  python data/prostate_raw_data/create_prostate_splits.py \
     --input_dir ./data/prostate_data/preprocessed \
     --output_dir ./data/prostate_data \
     --kfold 5

Output:
  data/prostate_data/
  â”œâ”€â”€ train.csv         # 80% des patients
  â””â”€â”€ validation.csv    # 20% des patients
  
  Format CSV:
  data_path,case_name
  ./data/prostate_data/preprocessed/patient_001,patient_001
  ...

Code: data/prostate_raw_data/create_prostate_splits.py
ğŸ“– Pour plus: GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "GÃ©nÃ©ration des splits"

Ã‰TAPE 4: ENTRAÃNEMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Commande (Single GPU):
  python train_scripts/trainer_ddp.py \
     --config experiments/prostate_seg/config_prostate.yaml

Commande (Multi-GPU):
  CUDA_VISIBLE_DEVICES=0,1 python -m torch.distributed.launch \
     --nproc_per_node=2 \
     train_scripts/trainer_ddp.py \
     --config experiments/prostate_seg/config_prostate.yaml

Configuration:
  â€¢ Fichier: experiments/prostate_seg/config_prostate.yaml
  â€¢ Modifiez les hyperparamÃ¨tres selon vos donnÃ©es
  â€¢ Checkpoints sauvegardÃ©s: experiments/prostate_seg/checkpoints/

Monitoring:
  â€¢ Logs: experiments/prostate_seg/logs/
  â€¢ Optionnel: IntÃ©gration Wandb (modifier config)

Code: architectures/segformer3d.py (architecture)
ğŸ“– Pour plus: GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "EntraÃ®nement"

Ã‰TAPE 5: INFÃ‰RENCE (PRÃ‰DICTION)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Commande:
  python experiments/prostate_seg/inference_prostate.py \
     --model_path ./experiments/prostate_seg/checkpoints/best.pt \
     --input_dir ./test_data/raw \
     --output_dir ./test_predictions \
     --save_nifti true

Processus:
  1. Charge checkpoint entraÃ®nÃ©
  2. Charge donnÃ©es nii.gz (T2, ADC)
  3. Resample Ã  96Ã—96Ã—96
  4. InfÃ©rence (simple ou sliding window)
  5. Post-traitement (seuil, morphologie)
  6. Sauvegarde en nii.gz

Input:
  test_data/raw/patient_XXX/{T2,ADC}.nii.gz

Output:
  test_predictions/patient_XXX/segmentation_pred.nii.gz

Code: experiments/prostate_seg/inference_prostate.py â†’ ProstateInferencer
ğŸ“– Pour plus: GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "InfÃ©rence"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ DÃ‰MARRAGE RAPIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OPTION 1: Utiliser le script bash (RecommandÃ©)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  chmod +x quick_start_prostate.sh
  ./quick_start_prostate.sh /chemin/vers/prostate_raw_data

Le script va:
  1. DÃ©tecter les patients
  2. Lancer le prÃ©traitement
  3. GÃ©nÃ©rer les splits
  4. Proposer entraÃ®nement
  5. Proposer infÃ©rence

OPTION 2: Manuel (ContrÃ´le complet)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # 1. PrÃ©traitement
  python data/prostate_raw_data/prostate_preprocess.py \
     --input_dir ./data/prostate_raw_data \
     --output_dir ./data/prostate_data/preprocessed

  # 2. Splits
  python data/prostate_raw_data/create_prostate_splits.py \
     --input_dir ./data/prostate_data/preprocessed \
     --output_dir ./data/prostate_data

  # 3. EntraÃ®nement
  python train_scripts/trainer_ddp.py \
     --config experiments/prostate_seg/config_prostate.yaml

  # 4. InfÃ©rence
  python experiments/prostate_seg/inference_prostate.py \
     --model_path ./experiments/prostate_seg/checkpoints/best.pt \
     --input_dir ./test_data/raw \
     --output_dir ./test_predictions

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â“ FAQ & DÃ‰PANNAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Q: Quelle est la diffÃ©rence avec BraTS?
R: â†’ Consultez ADAPTATION_PROSTATE_README.txt â†’ Section "DiffÃ©rences par rapport Ã  BraTS"

Q: Comment modifier la configuration?
R: â†’ Ã‰ditez experiments/prostate_seg/config_prostate.yaml
   â†’ Consultez GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "Configuration avancÃ©e"

Q: J'ai une erreur "CUDA out of memory"
R: â†’ RÃ©duisez batch_size dans config_prostate.yaml
   â†’ Consultez GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "DÃ©pannage"

Q: Comment adapter pour plus de modalitÃ©s?
R: â†’ Utilisez ProstateSegDatasetMultiModal au lieu de ProstateSegDataset
   â†’ Modifiez in_channels dans config_prostate.yaml
   â†’ Consultez dataloaders/prostate_seg.py

Q: Quels paramÃ¨tres d'infÃ©rence utiliser?
R: â†’ Les paramÃ¨tres par dÃ©faut conviennent gÃ©nÃ©ralement
   â†’ Ajustez --threshold selon vos besoins
   â†’ Consultez GUIDE_PROSTATE_COMPLETE_FR.md â†’ Section "InfÃ©rence"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ POINTS CLÃ‰S Ã€ RETENIR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. FORMAT DONNÃ‰ES
   â€¢ EntrÃ©e: nii.gz (NIfTI)
   â€¢ IntermÃ©diaire: PyTorch .pt (aprÃ¨s preprocessing)
   â€¢ Format rÃ©seau: Flexible (in_channels=2, num_classes=2)

2. PIPELINE
   raw nii.gz â†’ preprocess â†’ .pt â†’ dataloader â†’ train â†’ checkpoint â†’ infÃ©rence â†’ pred nii.gz

3. ARCHITECTURE
   â€¢ SegFormer3D (Vision Transformer 3D)
   â€¢ EntrÃ©es: 2 modalitÃ©s (T2, ADC)
   â€¢ Sorties: 2 classes (fond, prostate)
   â€¢ Taille: 96Ã—96Ã—96

4. DÃ‰PENDANCES
   â€¢ nibabel (nii.gz I/O)
   â€¢ scipy, scikit-image (image processing)
   â€¢ torch, monai (deep learning)

5. DÃ‰PANNAGE
   â€¢ Consultez GUIDE_PROSTATE_COMPLETE_FR.md
   â€¢ VÃ©rifiez les formats d'entrÃ©e
   â€¢ Testez sur petit subset avant grand entraÃ®nement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ PROCHAINES Ã‰TAPES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. â–¡ Lisez ADAPTATION_PROSTATE_README.txt (15 min)
2. â–¡ Organisez donnÃ©es en data/prostate_raw_data/patient_XXX
3. â–¡ ExÃ©cutez prostate_preprocess.py (30 min - 2h selon donnÃ©es)
4. â–¡ ExÃ©cutez create_prostate_splits.py (< 1 min)
5. â–¡ Modifiez experiments/prostate_seg/config_prostate.yaml selon besoin
6. â–¡ Lancez entraÃ®nement (dÃ©pend du nombre de patients et GPU)
7. â–¡ Ã‰valuez sur validation set
8. â–¡ InfÃ©rence sur test set avec inference_prostate.py

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ SUPPORT & RESSOURCES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Documentation:
  â€¢ GUIDE_PROSTATE_COMPLETE_FR.md    â†’ Guide complet Ã©tape par Ã©tape
  â€¢ ADAPTATION_PROSTATE_README.txt   â†’ Vue d'ensemble rapide
  â€¢ FICHIERS_PROSTATE_RESUME.txt     â†’ RÃ©fÃ©rence technique complÃ¨te

Code Source:
  â€¢ dataloaders/prostate_seg.py              â†’ Dataloader
  â€¢ data/prostate_raw_data/prostate_preprocess.py    â†’ Preprocessing
  â€¢ experiments/prostate_seg/inference_prostate.py   â†’ Inference
  â€¢ experiments/prostate_seg/config_prostate.yaml    â†’ Configuration

Ressources externes:
  â€¢ MONAI docs: https://docs.monai.io
  â€¢ NIfTI format: https://nifti.nimh.nih.gov
  â€¢ Vision Transformers: https://arxiv.org/abs/2010.11929

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… VOUS ÃŠTES PRÃŠT!

Commencez par lire ADAPTATION_PROSTATE_README.txt, puis suivez le workflow
complet. Tous les fichiers sont prÃªts Ã  l'emploi avec documentation complÃ¨te
en franÃ§ais.

Bon entraÃ®nement! ğŸš€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DerniÃ¨re mise Ã  jour: 2025-01-01
Version: 1.0
